<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ‡Ù†Ø¦Ø© Ø±Ù…Ø¶Ø§Ù† - Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨Ùƒ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: 'Cairo', sans-serif; text-align: center; padding: 10px; }
        .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .template-selector { display: flex; justify-content: center; gap: 15px; margin: 20px 0; }
        .template-option { width: 100px; cursor: pointer; border: 3px solid transparent; border-radius: 10px; transition: 0.3s; opacity: 0.6; }
        .template-option.selected { border-color: #4a5578; opacity: 1; transform: scale(1.1); }
        .template-option img { width: 100%; border-radius: 7px; }
        input { width: 90%; padding: 15px; margin: 10px 0; border-radius: 10px; border: 2px solid #e0e0e0; text-align: center; font-size: 18px; }
        button { background: #4a5578; color: white; padding: 15px; border: none; border-radius: 10px; cursor: pointer; width: 100%; font-size: 18px; font-weight: bold; }
        #result img { max-width: 100%; margin-top: 20px; border-radius: 10px; }
        .download-btn { display: inline-block; margin-top: 15px; background: #27ae60; color: white; text-decoration: none; padding: 10px 20px; border-radius: 8px; }
        canvas { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸŒ™ Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨ Ø§Ù„ØªÙ‡Ù†Ø¦Ø©</h2>
        <div class="template-selector">
            <div class="template-option selected" onclick="selectTemplate('ramadan.jpg', this)">
                <img src="ramadan.jpg">
                <span>Ù‚Ø§Ù„Ø¨ 1</span>
            </div>
            <div class="template-option" onclick="selectTemplate('ramadan2.jpg', this)">
                <img src="ramadan2.jpg">
                <span>Ù‚Ø§Ù„Ø¨ 2</span>
            </div>
        </div>

        <input type="text" id="userName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." maxlength="25">
        <button onclick="createCard()">ØµÙ…Ù… Ø¨Ø·Ø§Ù‚ØªÙƒ Ø§Ù„Ø¢Ù†</button>
        <div id="result"></div>
    </div>

    <canvas id="cardCanvas"></canvas>

    <script>
        let selectedImgSrc = 'ramadan.jpg';

        function selectTemplate(imgName, element) {
            selectedImgSrc = imgName;
            document.querySelectorAll('.template-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
        }

        async function createCard() {
            const name = document.getElementById('userName').value;
            const myApiUrl = "https://sheetdb.io/api/v1/o9rk5zcf0ti1x"; 

            if (!name) { alert("Ù„Ø·ÙØ§Ù‹ Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…"); return; }

            fetch(myApiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ "Ø§Ù„Ø§Ø³Ù…": name, "Ø§Ù„Ù‚Ø§Ù„Ø¨": selectedImgSrc, "Ø§Ù„ØªØ§Ø±ÙŠØ®": new Date().toLocaleString('ar-EG') })
            }).catch(err => console.log("Sent"));

            const canvas = document.getElementById('cardCanvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.src = selectedImgSrc; 
            
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                ctx.font = 'bold 55px Cairo'; 
                ctx.textAlign = 'center';
                
                // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯ÙˆØ¯ Ø³ÙˆØ¯Ø§Ø¡ Ø®ÙÙŠÙØ© Ø¬Ø¯Ø§Ù‹
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 1; // Ø£Ù‚Ù„ Ø¯Ø±Ø¬Ø© Ø­Ø¯ÙˆØ¯
                ctx.strokeText(name, canvas.width / 2, canvas.height * 0.90);
                
                // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø¨ÙŠØ¶
                ctx.fillStyle = 'white'; 
                ctx.fillText(name, canvas.width / 2, canvas.height * 0.90); 
                
                const finalImage = canvas.toDataURL('image/png');
                document.getElementById('result').innerHTML = `
                    <img src="${finalImage}">
                    <br>
                    <a href="${finalImage}" download="Ramadan_Card.png" class="download-btn">â¬‡ï¸ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</a>
                `;
            };
        }
    </script>
</body>
</html>
