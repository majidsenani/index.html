<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ‡Ù†Ø¦Ø© Ø±Ù…Ø¶Ø§Ù†</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: 'Cairo', sans-serif; text-align: center; padding: 10px; margin: 0; }
        .container { max-width: 450px; margin: 20px auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .template-selector { display: flex; justify-content: center; gap: 10px; margin: 20px 0; }
        .template-option { width: 100px; cursor: pointer; border: 3px solid transparent; border-radius: 12px; transition: 0.3s; opacity: 0.6; overflow: hidden; background: #eee; }
        .template-option.selected { border-color: #4a5578; opacity: 1; transform: scale(1.05); }
        .template-option img { width: 100%; height: 120px; object-fit: cover; display: block; }
        .template-option span { font-size: 12px; padding: 5px 0; display: block; font-weight: bold; }
        input, textarea { width: 90%; padding: 15px; margin: 10px 0; border-radius: 10px; border: 2px solid #e0e0e0; text-align: center; font-size: 18px; outline: none; font-family: 'Cairo', sans-serif; }
        textarea { height: 60px; resize: none; font-size: 15px; } /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª */
        button { background: #4a5578; color: white; padding: 15px; border: none; border-radius: 10px; cursor: pointer; width: 100%; font-size: 18px; font-weight: bold; }
        #result img { max-width: 100%; margin-top: 20px; border-radius: 10px; }
        .download-btn { display: inline-block; margin-top: 15px; background: #27ae60; color: white; text-decoration: none; padding: 12px 25px; border-radius: 8px; font-weight: bold; }
        canvas { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸŒ™ Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨Ùƒ Ø§Ù„Ù…ÙØ¶Ù„</h2>
        <div class="template-selector">
            <div class="template-option selected" data-id="1" onclick="selectTemplate('ramadan1.jpg', this)">
                <img src="ramadan1.jpg">
                <span>Ù‚Ø§Ù„Ø¨ 1</span>
            </div>
            <div class="template-option" data-id="2" onclick="selectTemplate('ramadan2.jpg', this)">
                <img src="ramadan2.jpg">
                <span>Ù‚Ø§Ù„Ø¨ 2</span>
            </div>
            <div class="template-option" data-id="3" onclick="selectTemplate('ramadan3.jpg', this)">
                <img src="ramadan3.jpg">
                <span>Ù‚Ø§Ù„Ø¨ 3</span>
            </div>
        </div>

        <input type="text" id="userName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." maxlength="25">
        
        <textarea id="userNote" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù€ (Ù…Ø§Ø¬Ø¯) Ù‡Ù†Ø§.."></textarea>
        
        <button onclick="createCard()">ØµÙ…Ù… Ø¨Ø·Ø§Ù‚ØªÙƒ Ø§Ù„Ø¢Ù†</button>
        <div id="result"></div>
    </div>

    <canvas id="cardCanvas"></canvas>

    <script>
        let selectedImgSrc = 'ramadan1.jpg';
        let selectedTemplateId = '1';

        function selectTemplate(imgName, element) {
            selectedImgSrc = imgName;
            selectedTemplateId = element.getAttribute('data-id');
            document.querySelectorAll('.template-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
        }

        async function createCard() {
            const name = document.getElementById('userName').value;
            const note = document.getElementById('userNote').value; // Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
            const myApiUrl = "https://sheetdb.io/api/v1/o9rk5zcf0ti1x"; 
            if (!name) { alert("Ù„Ø·ÙØ§Ù‹ Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…"); return; }

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¥ÙƒØ³Ù„ Ø´Ø§Ù…Ù„Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
            fetch(myApiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    "Ø§Ù„Ø§Ø³Ù…": name, 
                    "Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©": note, 
                    "Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨": selectedTemplateId, 
                    "Ø§Ù„ØªØ§Ø±ÙŠØ®": new Date().toLocaleString('ar-EG') 
                })
            }).catch(err => console.log("Sent"));

            const canvas = document.getElementById('cardCanvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.src = selectedImgSrc; 
            
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                ctx.font = 'bold 55px Cairo'; 
                ctx.textAlign = 'center';
                
                let yPos;
                let textColor;

                // ØªÙ… Ø§Ù„Ø¥Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ÙˆØ§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªÙŠ Ø·Ù„Ø¨ØªÙ‡Ø§ Ø¨Ø§Ù„Ø¶Ø¨Ø·
                if (selectedImgSrc === 'ramadan1.jpg') {
                    yPos = canvas.height * 0.90;
                    textColor = "white";
                } 
                else if (selectedImgSrc === 'ramadan2.jpg') {
                    yPos = canvas.height * 0.81;
                    textColor = "#8b6d31"; 
                } 
                else if (selectedImgSrc === 'ramadan3.jpg') {
                    yPos = canvas.height * 0.94; // ØªØ­Øª ÙƒÙ„Ù…Ø© Ø±Ù…Ø¶Ø§Ù† ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª Ø£Ø®ÙŠØ±Ø§Ù‹
                    textColor = "#5d5c3c";
                }

                ctx.fillStyle = textColor; 
                ctx.fillText(name, canvas.width / 2, yPos); 
                
                const finalImage = canvas.toDataURL('image/png');
                document.getElementById('result').innerHTML = `
                    <img src="${finalImage}">
                    <br>
                    <a href="${finalImage}" download="Ramadan_Card.png" class="download-btn">â¬‡ï¸ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</a>
                `;
            };
        }
    </script>
</body>
</html>
